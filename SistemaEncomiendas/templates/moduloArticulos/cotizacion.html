{% extends "base4.html" %}
{% load static %}
{% block titulo %}Cotizacion{% endblock titulo %}

{% block body %}

<div class="container mt-3">
    <div class=" row bg-secondary py-1" >
        <h3 class="mb-1 text-white">Articulos</h3>
    </div >
    <div class=" row align-items-center border mt-1 " style="background-color: #F5F0EF;">
        <div class="col-md-6  ">
            <div class="d-flex ">
                <p class="mb-1 font-weight-bold">
                    <b>
                        <i class="fas fa-check-circle"></i>Cotizacion Articulo</b>
                </p> 
            </div>
        </div>
        <div class="col-md-6  mb-1">
            <div class="d-flex justify-content-end   ">
                <a href="{%url 'home' %}" class="btn" style="background-color: rgb(24, 17, 217); color: #F5F0EF;"><i class="fas fa-arrow-left"></i>Regresar</a>
            </div>
        </div>
    </div >

</div >

<section class="vh-100" >
    <div class="container py-3 " >
        <div class="row d-flex justify-content-center  h-100"  >
            <div class="col col-12" >
                
                <div class="card" style="border-radius: 1rem;"  >
                    <div class="row g-0" >
                        <div class="col d-flex align-items-center " style="background-color: #F5F0EF;border-radius: 1rem 1rem 1rem 1rem; "><!--form-->
                            
                            <div class="card-body p-4 p-lg-5 text-black d-flex justify-content-center align-items-center" >
                                
                                <form action="{%url 'moduloArticulos:cotizacion'%}" method="POST"  class="w-75">
                                    {% csrf_token %}
                                    <h5 class="fw-normal  mb-3 pb-3 " style="letter-spacing: 1px; ;"><b>Cotizacion</b> </h5>
                                    <hr>
                                    
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="input-group me-2" style="width: 50%;">
                                            <span class="input-group-text" id="inputGroup-sizing-sm"><b>Tipo de Servicio</b></span>
                                            <select id="id_servicio" name="id_servicio" class="form-control" aria-label="Sizing example input" onchange="mostrarSelector()">
                                                {% for servicio in servicios %}
                                                <option value={{servicio.id_servicio}}>{{servicio.nombre_servicio}}</option>
                                                {% endfor %}
                                            </select>  
                                        </div>

                                        <!-- Selector oculto TIPO DE ARTICULO -->
                                        <div id="categoria-articulo" class="input-group ms-2" style="display: none; width: 50%;">
                                            <span class="input-group-text"><b>Categoria</b></span>
                                            <select id="categoria" name="categoria-articulo" class="form-control" aria-label="Sizing example input" onchange="actualizarSelectorDescripcionArticulo()">
                                                <option value="PRENDAS DE VESTIR Y ACCESORIOS PARA HOMBRE">PRENDAS DE VESTIR Y ACCESORIOS PARA HOMBRE</option>
                                                <option value="PRENDAS DE VESTIR Y ACCESORIOS PARA DAMA">PRENDAS DE VESTIR Y ACCESORIOS PARA DAMA</option>
                                                <option value="PRENDAS DE VESTIR Y ACCESORIOS PARA NIÑOS Y BEBÉS">PRENDAS DE VESTIR Y ACCESORIOS PARA NIÑOS Y BEBÉS</option>
                                                <option value="JUGUETES">JUGUETES</option>
                                                <option value="UTILES ESCOLARES Y ARTICULOS DE OFICINA">UTILES ESCOLARES Y ARTICULOS DE OFICINA</option>
                                                <option value="COSMÉTICOS, ACCESORIOS DE BELLEZA Y ARTICULOS DE HIGIENE PERSONAL">COSMÉTICOS, ACCESORIOS DE BELLEZA Y ARTICULOS DE HIGIENE PERSONAL</option>
                                                <option value="APARATOS ELÉCTRICOS DEL HOGAR">APARATOS ELÉCTRICOS DEL HOGAR</option>
                                                <option value="ALIMENTOS EMPACADOS O ENVASADOS">ALIMENTOS EMPACADOS O ENVASADOS</option>
                                                <option value="HERRAMIENTAS">HERRAMIENTAS</option>
                                                <option value="ARTICULOS NAVIDEÑOS">ARTICULOS NAVIDEÑOS</option>
                                                <option value="OTROS ARTICULOS IMPORTADOS">OTROS ARTICULOS IMPORTADOS</option>
                                            </select>
                                        </div>

                                    </div>
                                    
                                    <!-- Selector oculto TIPO DE MARCA-->
                                    <div class="d-flex align-items-center mb-3">
                                        <div id="tipo-marca" class="input-group me-2" style="display: none; width: 50%;">
                                            <span class="input-group-text"><b>Tipo de Marca</b></span>
                                            <select id="tipo-marcas" name="tipo-marca" class="form-control" aria-label="Sizing example input" onchange="actualizarSelectorMarcas(), actualizarSelectorDescripcionArticulo(), mostrarCosto()">
                                                <option value="">Selecciona un tipo</option>
                                                <option value="Lujo">Lujo</option>
                                                <option value="Prestigio">Prestigio</option>
                                                <option value="Otras Marcas">Otras Marcas</option>
                                            </select>
                                           
                                        </div>
                                        
                                        <!-- Selector oculto NOMBRE DE LA MARCA -->
                                        <div id="marca" class="input-group ms-2" style="display: none; width: 50%;">
                                            <span class="input-group-text"><b>Marca</b></span>
                                            <select id="marcas" name="id_lis_marcas" class="form-control" aria-label="Sizing example input">
                                                <option value="">Selecciona una marca</option>
                                            </select>
                                        </div>  
                                    </div>
                                    <!-- Selector oculto TIPO DE ARTICULO -->
                                    <div id="tipo-art" class="input-group input-group mb-3" style="width: 50%;">
                                        <span class="input-group-text" id="inputGroup-sizing-sm"><b>Descripcion de Articulo</b></span>
                                        <select id="id_ti_articulo" name="id_ti_articulo" class="form-control" aria-label="Sizing example input">
                                            <option value="">Descripcion</option>
                                            
                                        </select>  
                                    </div>

                                    <!-- FORM NORMAL -->
                                    <div class="input-group input-group mb-3">
                                        <span class="input-group-text" id="inputGroup-sizing-sm"><b>Nombre del Articulo</b></span>
                                        <input type="text" name="nombre_articulo" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm">
                                    </div>
                                    <div class="input-group input-group mb-3" style="width: 50%;">
                                        <span class="input-group-text" id="inputGroup-sizing-sm"><b>Cantidad</b></span>
                                        <input type="number" name="cantidad" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" min="1" step="1" placeholder="Seleccione la cantidad">
                                    </div>
                                    <div class="input-group input-group mb-3" style="width: 50%;">
                                        <span class="input-group-text" id="inputGroup-sizing-sm"><b>Peso en Libras</b></span>
                                        <span class="input-group-text" id="inputGroup-sizing-sm"><b>lb</b></span>
                                        <input type="number" name="peso" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" min="0" step="0.01" placeholder="00.00">
                                    </div>
                                    
                                    <div id="costo" class="input-group input-group mb-3" style=" width: 50%;">
                                        <span class="input-group-text" id="inputGroup-sizing-sm"><b>Costo Encomienda</b></span>
                                        <span class="input-group-text" id="inputGroup-sizing-sm"><b>$</b></span>
                                        <input type="number" name="costoenco" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" min="0" step="0.01" placeholder="00.00">
                                    </div>

                                    <div class="input-group input-group mb-3" style="width: 50%;">
                                        <span class="input-group-text" id="inputGroup-sizing-sm"><b>Impuestos totales por envio</b></span>
                                        <input type="" disabled="TRUE" required value="$ {{impuesto}}" name="impuestos_envio" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm">
                                    </div>

                                    <div class="pt-1 mb-4  d-flex justify-content-end">
                                        <button class="btn btn-success btn-lg btn-block me-2" type="submit"><i class="far fa-save "></i>  Calcular</button>
                                        <a href="{%url 'moduloArticulos:mostrar_articulos' %}">
                                            <button class="btn btn-danger btn-lg btn-block" type="button"><i class="fas fa-times"></i>  Cancelar</button>
                                        </a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>
</section>

<script>
    //FUNCIONES PARA JS PARA MOSTRAR LOS SELECTORES OCULTOS
    function mostrarSelector() {
        console.log("mostrarSelector ha sido llamada");
        var select = document.getElementById("id_servicio");
        var nuevoSelector = document.getElementById("categoria-articulo");
        var typeMarcaSelector = document.getElementById("tipo-marca");
        var MarcaSelector = document.getElementById("marca");
        var articuloSelector = document.getElementById("tipo-art");
    
        // Mostrar el nuevo selector si la opción seleccionada es "articulos varios o compas en linea"
        if (select.value === "2"||select.value === "6") {
            nuevoSelector.style.display = "flex";
            nuevoSelector.classList.add("input-group");
            typeMarcaSelector.style.display = "flex";
            typeMarcaSelector.classList.add("input-group");
            MarcaSelector.style.display = "flex";
            MarcaSelector.classList.add("input-group");
            articuloSelector.style.display = "flex";
            articuloSelector.classList.add("input-group");

        } else if (select.value === "1"){
            nuevoSelector.style.display = "flex";
            nuevoSelector.classList.add("input-group");
            articuloSelector.style.display = "flex";
            articuloSelector.classList.add("input-group");
            typeMarcaSelector.style.display = "none";
            MarcaSelector.style.display = "none";
        } else {
            nuevoSelector.style.display = "none";
            typeMarcaSelector.style.display = "none";
            MarcaSelector.style.display = "none";
            articuloSelector.style.display = "none";
        }
    }

</script>


<script>
    
    function mostrarCosto() {
        var select = document.getElementById("tipo-marcas").value;
        const inputcos = document.getElementById("costo");
    
        if (select === "Lujo") {
            inputcos.style.display = "flex";
            inputcos.classList.add("input-group");
    
        } else {
            inputcos.style.display = "none";
            
        }
    }

</script>

<script>
   function actualizarSelectorMarcas() {
        var tipoMarca = document.getElementById("tipo-marcas").value;
        var marcaSelector = document.getElementById("marcas");

        // Limpiar las opciones de Selector B
        marcaSelector.innerHTML = '<option value="">Selecciona una marca</option>';

        // Si se selecciona "Otras", no hacer nada más
        if (tipoMarca === "Otras Marcas" || tipoMarca === "") {
            return;
        }

        // Realizar solicitud AJAX a la vista de Django
        fetch("{% url 'moduloArticulos:filtrar_marcas' %}?tipo_marca=" + tipoMarca)
            .then(response => response.json())
            .then(data => {
                // Limpiar el select antes de agregar nuevas opciones
                marcaSelector.innerHTML = "<option value=''>Selecciona una marca</option>";

                // Agregar marcas usando forEach
                data.forEach(function(marca) {
                    var option = document.createElement("option");
                    option.value = marca.id;  // Asignar el ID de la marca
                    option.text = marca.nombre;     // Asignar el nombre de la marca
                    marcaSelector.appendChild(option);
                });
            })
            .catch(error => console.error('Error al obtener las marcas:', error));
        }   
</script>
<script>
    function actualizarSelectorDescripcionArticulo() {
     var tipoMarca = document.getElementById("tipo-marcas").value;
     var categoriaSelector = document.getElementById("categoria").value;
     var articuloSelector = document.getElementById("id_ti_articulo");
 
     // Limpiar las opciones de Selector B
     articuloSelector.innerHTML = '<option value="">Selecciona una marca</option>';
 
     // Si se selecciona "Otras", no hacer nada más
     if (tipoMarca === "") {
         return;
     }
 
     // Realizar solicitud AJAX a la vista de Django
     fetch("{% url 'moduloArticulos:filtrar_tipo_articulo' %}?tipo_marca=" + tipoMarca +"&catego="+categoriaSelector)
         .then(response => response.json())
         .then(data => {
             console.log(data);  // Verifica que los datos sean los esperados
 
             // Limpiar el select antes de agregar nuevas opciones
             articuloSelector.innerHTML = "<option value=''>Selecciona una marca</option>";
 
             // Agregar marcas usando forEach
             data.forEach(function(articulo) {
                 var option = document.createElement("option");
                 option.value = articulo.id;  // Asignar el ID de la marca
                 option.text = articulo.nombre;     // Asignar el nombre de la marca
                 articuloSelector.appendChild(option);
             });
         })
         .catch(error => console.error('Error al obtener las marcas:', error));
 
 }   
 </script>


{% endblock body%}